#include "math.h"

//---------------------------------------------------------------------------
// https://github.com/devkitPro/libtonc/blob/master/asm/

// sin_lut: a 514 long LUT of 16bit values in 4.12 format
// sin(x*pi/256)
u16 sin_lut[] = {
	0x0000,0x0032,0x0064,0x0096,0x00C8,0x00FB,0x012D,0x015F,
	0x0191,0x01C3,0x01F5,0x0227,0x0259,0x028A,0x02BC,0x02ED,
	0x031F,0x0350,0x0381,0x03B2,0x03E3,0x0413,0x0444,0x0474,
	0x04A5,0x04D5,0x0504,0x0534,0x0563,0x0593,0x05C2,0x05F0,
	0x061F,0x064D,0x067B,0x06A9,0x06D7,0x0704,0x0731,0x075E,
	0x078A,0x07B7,0x07E2,0x080E,0x0839,0x0864,0x088F,0x08B9,
	0x08E3,0x090D,0x0936,0x095F,0x0987,0x09B0,0x09D7,0x09FF,
	0x0A26,0x0A4D,0x0A73,0x0A99,0x0ABE,0x0AE3,0x0B08,0x0B2C,

	0x0B50,0x0B73,0x0B96,0x0BB8,0x0BDA,0x0BFC,0x0C1D,0x0C3E,
	0x0C5E,0x0C7D,0x0C9D,0x0CBB,0x0CD9,0x0CF7,0x0D14,0x0D31,
	0x0D4D,0x0D69,0x0D84,0x0D9F,0x0DB9,0x0DD2,0x0DEB,0x0E04,
	0x0E1C,0x0E33,0x0E4A,0x0E60,0x0E76,0x0E8B,0x0EA0,0x0EB4,
	0x0EC8,0x0EDB,0x0EED,0x0EFF,0x0F10,0x0F21,0x0F31,0x0F40,
	0x0F4F,0x0F5D,0x0F6B,0x0F78,0x0F85,0x0F91,0x0F9C,0x0FA7,
	0x0FB1,0x0FBA,0x0FC3,0x0FCB,0x0FD3,0x0FDA,0x0FE1,0x0FE7,
	0x0FEC,0x0FF0,0x0FF4,0x0FF8,0x0FFB,0x0FFD,0x0FFE,0x0FFF,

	0x1000,0x0FFF,0x0FFE,0x0FFD,0x0FFB,0x0FF8,0x0FF4,0x0FF0,
	0x0FEC,0x0FE7,0x0FE1,0x0FDA,0x0FD3,0x0FCB,0x0FC3,0x0FBA,
	0x0FB1,0x0FA7,0x0F9C,0x0F91,0x0F85,0x0F78,0x0F6B,0x0F5D,
	0x0F4F,0x0F40,0x0F31,0x0F21,0x0F10,0x0EFF,0x0EED,0x0EDB,
	0x0EC8,0x0EB4,0x0EA0,0x0E8B,0x0E76,0x0E60,0x0E4A,0x0E33,
	0x0E1C,0x0E04,0x0DEB,0x0DD2,0x0DB9,0x0D9F,0x0D84,0x0D69,
	0x0D4D,0x0D31,0x0D14,0x0CF7,0x0CD9,0x0CBB,0x0C9D,0x0C7D,
	0x0C5E,0x0C3E,0x0C1D,0x0BFC,0x0BDA,0x0BB8,0x0B96,0x0B73,

	0x0B50,0x0B2C,0x0B08,0x0AE3,0x0ABE,0x0A99,0x0A73,0x0A4D,
	0x0A26,0x09FF,0x09D7,0x09B0,0x0987,0x095F,0x0936,0x090D,
	0x08E3,0x08B9,0x088F,0x0864,0x0839,0x080E,0x07E2,0x07B7,
	0x078A,0x075E,0x0731,0x0704,0x06D7,0x06A9,0x067B,0x064D,
	0x061F,0x05F0,0x05C2,0x0593,0x0563,0x0534,0x0504,0x04D5,
	0x04A5,0x0474,0x0444,0x0413,0x03E3,0x03B2,0x0381,0x0350,
	0x031F,0x02ED,0x02BC,0x028A,0x0259,0x0227,0x01F5,0x01C3,
	0x0191,0x015F,0x012D,0x00FB,0x00C8,0x0096,0x0064,0x0032,

	0x0000,0xFFCE,0xFF9C,0xFF6A,0xFF38,0xFF05,0xFED3,0xFEA1,
	0xFE6F,0xFE3D,0xFE0B,0xFDD9,0xFDA7,0xFD76,0xFD44,0xFD13,
	0xFCE1,0xFCB0,0xFC7F,0xFC4E,0xFC1D,0xFBED,0xFBBC,0xFB8C,
	0xFB5B,0xFB2B,0xFAFC,0xFACC,0xFA9D,0xFA6D,0xFA3E,0xFA10,
	0xF9E1,0xF9B3,0xF985,0xF957,0xF929,0xF8FC,0xF8CF,0xF8A2,
	0xF876,0xF849,0xF81E,0xF7F2,0xF7C7,0xF79C,0xF771,0xF747,
	0xF71D,0xF6F3,0xF6CA,0xF6A1,0xF679,0xF650,0xF629,0xF601,
	0xF5DA,0xF5B3,0xF58D,0xF567,0xF542,0xF51D,0xF4F8,0xF4D4,

	0xF4B0,0xF48D,0xF46A,0xF448,0xF426,0xF404,0xF3E3,0xF3C2,
	0xF3A2,0xF383,0xF363,0xF345,0xF327,0xF309,0xF2EC,0xF2CF,
	0xF2B3,0xF297,0xF27C,0xF261,0xF247,0xF22E,0xF215,0xF1FC,
	0xF1E4,0xF1CD,0xF1B6,0xF1A0,0xF18A,0xF175,0xF160,0xF14C,
	0xF138,0xF125,0xF113,0xF101,0xF0F0,0xF0DF,0xF0CF,0xF0C0,
	0xF0B1,0xF0A3,0xF095,0xF088,0xF07B,0xF06F,0xF064,0xF059,
	0xF04F,0xF046,0xF03D,0xF035,0xF02D,0xF026,0xF01F,0xF019,
	0xF014,0xF010,0xF00C,0xF008,0xF005,0xF003,0xF002,0xF001,

	0xF000,0xF001,0xF002,0xF003,0xF005,0xF008,0xF00C,0xF010,
	0xF014,0xF019,0xF01F,0xF026,0xF02D,0xF035,0xF03D,0xF046,
	0xF04F,0xF059,0xF064,0xF06F,0xF07B,0xF088,0xF095,0xF0A3,
	0xF0B1,0xF0C0,0xF0CF,0xF0DF,0xF0F0,0xF101,0xF113,0xF125,
	0xF138,0xF14C,0xF160,0xF175,0xF18A,0xF1A0,0xF1B6,0xF1CD,
	0xF1E4,0xF1FC,0xF215,0xF22E,0xF247,0xF261,0xF27C,0xF297,
	0xF2B3,0xF2CF,0xF2EC,0xF309,0xF327,0xF345,0xF363,0xF383,
	0xF3A2,0xF3C2,0xF3E3,0xF404,0xF426,0xF448,0xF46A,0xF48D,

	0xF4B0,0xF4D4,0xF4F8,0xF51D,0xF542,0xF567,0xF58D,0xF5B3,
	0xF5DA,0xF601,0xF629,0xF650,0xF679,0xF6A1,0xF6CA,0xF6F3,
	0xF71D,0xF747,0xF771,0xF79C,0xF7C7,0xF7F2,0xF81E,0xF849,
	0xF876,0xF8A2,0xF8CF,0xF8FC,0xF929,0xF957,0xF985,0xF9B3,
	0xF9E1,0xFA10,0xFA3E,0xFA6D,0xFA9D,0xFACC,0xFAFC,0xFB2B,
	0xFB5B,0xFB8C,0xFBBC,0xFBED,0xFC1D,0xFC4E,0xFC7F,0xFCB0,
	0xFCE1,0xFD13,0xFD44,0xFD76,0xFDA7,0xFDD9,0xFE0B,0xFE3D,
	0xFE6F,0xFEA1,0xFED3,0xFF05,0xFF38,0xFF6A,0xFF9C,0xFFCE,
	0x0000,0x0032
};

// div_lut: a 257 long LUT of 32bit values in 16.16 format
// ceil(1/x)
u32 div_lut[] = {
	0x7FFFFFFF,0x00010000,0x00008000,0x00005556,0x00004000,0x00003334,0x00002AAB,0x00002493,
	0x00002000,0x00001C72,0x0000199A,0x00001746,0x00001556,0x000013B2,0x0000124A,0x00001112,
	0x00001000,0x00000F10,0x00000E39,0x00000D7A,0x00000CCD,0x00000C31,0x00000BA3,0x00000B22,
	0x00000AAB,0x00000A3E,0x000009D9,0x0000097C,0x00000925,0x000008D4,0x00000889,0x00000843,
	0x00000800,0x000007C2,0x00000788,0x00000751,0x0000071D,0x000006EC,0x000006BD,0x00000691,
	0x00000667,0x0000063F,0x00000619,0x000005F5,0x000005D2,0x000005B1,0x00000591,0x00000573,
	0x00000556,0x0000053A,0x0000051F,0x00000506,0x000004ED,0x000004D5,0x000004BE,0x000004A8,
	0x00000493,0x0000047E,0x0000046A,0x00000457,0x00000445,0x00000433,0x00000422,0x00000411,
	0x00000400,0x000003F1,0x000003E1,0x000003D3,0x000003C4,0x000003B6,0x000003A9,0x0000039C,
	0x0000038F,0x00000382,0x00000376,0x0000036A,0x0000035F,0x00000354,0x00000349,0x0000033E,
	0x00000334,0x0000032A,0x00000320,0x00000316,0x0000030D,0x00000304,0x000002FB,0x000002F2,
	0x000002E9,0x000002E1,0x000002D9,0x000002D1,0x000002C9,0x000002C1,0x000002BA,0x000002B2,
	0x000002AB,0x000002A4,0x0000029D,0x00000296,0x00000290,0x00000289,0x00000283,0x0000027D,
	0x00000277,0x00000271,0x0000026B,0x00000265,0x0000025F,0x0000025A,0x00000254,0x0000024F,
	0x0000024A,0x00000244,0x0000023F,0x0000023A,0x00000235,0x00000231,0x0000022C,0x00000227,
	0x00000223,0x0000021E,0x0000021A,0x00000215,0x00000211,0x0000020D,0x00000209,0x00000205,
	0x00000200,0x000001FD,0x000001F9,0x000001F5,0x000001F1,0x000001ED,0x000001EA,0x000001E6,
	0x000001E2,0x000001DF,0x000001DB,0x000001D8,0x000001D5,0x000001D1,0x000001CE,0x000001CB,
	0x000001C8,0x000001C4,0x000001C1,0x000001BE,0x000001BB,0x000001B8,0x000001B5,0x000001B3,
	0x000001B0,0x000001AD,0x000001AA,0x000001A7,0x000001A5,0x000001A2,0x0000019F,0x0000019D,
	0x0000019A,0x00000198,0x00000195,0x00000193,0x00000190,0x0000018E,0x0000018B,0x00000189,
	0x00000187,0x00000184,0x00000182,0x00000180,0x0000017E,0x0000017B,0x00000179,0x00000177,
	0x00000175,0x00000173,0x00000171,0x0000016F,0x0000016D,0x0000016B,0x00000169,0x00000167,
	0x00000165,0x00000163,0x00000161,0x0000015F,0x0000015D,0x0000015B,0x00000159,0x00000158,
	0x00000156,0x00000154,0x00000152,0x00000151,0x0000014F,0x0000014D,0x0000014B,0x0000014A,
	0x00000148,0x00000147,0x00000145,0x00000143,0x00000142,0x00000140,0x0000013F,0x0000013D,
	0x0000013C,0x0000013A,0x00000139,0x00000137,0x00000136,0x00000134,0x00000133,0x00000131,
	0x00000130,0x0000012F,0x0000012D,0x0000012C,0x0000012A,0x00000129,0x00000128,0x00000126,
	0x00000125,0x00000124,0x00000122,0x00000121,0x00000120,0x0000011F,0x0000011D,0x0000011C,
	0x0000011B,0x0000011A,0x00000119,0x00000117,0x00000116,0x00000115,0x00000114,0x00000113,
	0x00000112,0x00000110,0x0000010F,0x0000010E,0x0000010D,0x0000010C,0x0000010B,0x0000010A,
	0x00000109,0x00000108,0x00000107,0x00000106,0x00000105,0x00000104,0x00000103,0x00000102,
	0x00000100
};


//---------------------------------------------------------------------------
void MathInit(void)
{
	// EMPTY
}
//---------------------------------------------------------------------------
s16 MathSin(u16 theta)
{
	return sin_lut[(theta >> 7) & 0x1FF];
}
//---------------------------------------------------------------------------
s16 MathCos(u16 theta)
{
	return sin_lut[((theta >> 7) + 128) & 0x1FF];
}
//---------------------------------------------------------------------------
u32 MathDiv(u8 x)
{
	return div_lut[x];
}
